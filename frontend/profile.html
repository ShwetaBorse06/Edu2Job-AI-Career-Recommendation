<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-black min-h-screen text-white p-10">

  <div class="max-w-3xl mx-auto bg-white/10 p-8 rounded-xl shadow-xl backdrop-blur">

    <h1 class="text-3xl font-bold mb-6 text-center">Edit Profile</h1>

    <form id="profileForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Name -->
      <div>
        <label class="block mb-2">Full Name</label>
        <input id="name" type="text" class="w-full p-3 rounded bg-white/20" required>
      </div>

      <!-- Email (readonly) -->
      <div>
        <label class="block mb-2">Email</label>
        <input id="email" type="email" class="w-full p-3 rounded bg-white/20" readonly>
      </div>

      <!-- Phone -->
      <div>
        <label class="block mb-2">Phone</label>
        <input id="phone" type="text" class="w-full p-3 rounded bg-white/20" placeholder="Optional">
      </div>

      <!-- Location -->
      <div>
        <label class="block mb-2">Location</label>
        <input id="location" type="text" class="w-full p-3 rounded bg-white/20" placeholder="City">
      </div>

    </form>

    <div class="mt-8 text-center">
      <button id="saveBtn"
        class="bg-gradient-to-r from-purple-600 to-cyan-400 px-6 py-3 rounded-lg font-semibold text-lg hover:opacity-90">
        Save & Go Back to Dashboard
      </button>
    </div>

  </div>

<script>
  const token = localStorage.getItem("token");
  if (!token) {
    window.location.href = "login.html";
  }

  // Fetch user profile from backend
  async function loadProfile() {
    try {
      const res = await fetch("http://127.0.0.1:5000/user/profile", {
        headers: { "Authorization": "Bearer " + token }
      });
      const user = await res.json();
      if (user.error) {
        alert(user.error);
        return;
      }
      document.getElementById("name").value = user.name || "";
      document.getElementById("email").value = user.email || "";
      document.getElementById("phone").value = user.phone || "";
      document.getElementById("location").value = user.location || "";
    } catch (err) {
      console.error(err);
      alert("Failed to load profile");
    }
  }

  // Update profile to backend
  async function saveProfile() {
    const data = {
      name: document.getElementById("name").value,
      phone: document.getElementById("phone").value,
      location: document.getElementById("location").value
    };

    try {
      const res = await fetch("http://127.0.0.1:5000/user/profile/update", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      if (res.ok) {
        window.location.href = "dashboard.html";
      } else {
        alert(result.error || "Failed to update profile");
      }
    } catch (err) {
      console.error(err);
      alert("Error updating profile");
    }
  }

  document.getElementById("saveBtn").addEventListener("click", saveProfile);

  loadProfile();
</script>

</body>
</html>
